#include "core_power_converter.h"


void Core_power_converter::set_attributes()
{
    current_out.set_timestep(1, SIM_RESOLUTION);
    current_out.set_delay(1);
}

void Core_power_converter::initialize() {}

void Core_power_converter::processing()
{
    double eta; // Efficiency
    double i_bus_tmp;
    double v_in_tmp;

    // Read input quantities
    i_bus_tmp = current_in.read();
    //v_in_tmp = voltage_in.read();

    // Get efficiency
    eta = lut_eta.get_val(fabs(i_bus_tmp)) / 100; 
    tot_eff+=eta;
    tot_eff_reads+=1;
    eff_core.write(tot_eff/tot_eff_reads);
    current_out.write( i_bus_tmp*V_CORE / (VREF_BUS*eta));

}