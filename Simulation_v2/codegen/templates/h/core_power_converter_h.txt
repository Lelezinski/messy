#include <systemc-ams.h>
#include "config.h"
{% if core_converter=="core" -%}
#include "config_converter_core.h"
{% else -%}
#include "config_converter_battery.h"
{% endif -%}
#include "lut.h"

SCA_TDF_MODULE(Core_power_converter)
{
    double tot_eff=0;
    int tot_eff_reads=0;
    //Input Port
    sca_tdf::sca_in <double> current_in; //From Bus
    sca_tdf::sca_in <double> voltage_in; //From Battery
    //Output Port
    sca_tdf::sca_out <double> current_out; //To Battery
    sca_tdf::sca_out <double> eff_core;
    SCA_CTOR(Core_power_converter):
        current_in("Current_from_core"),
        voltage_in("Voltage_from_power_bus"),
        current_out("Current_to_battery"),
        eff_core("eff_core")
    {};

    void set_attributes();
    void initialize();
    void processing();

    void set_efficency(double k);

    Core_power_converter(){};
    
    private:
        double efficency_factor;
        {% if core_converter=="core" -%}
        LUT lut_eta = LUT(I_CONV_CORE, ETA_CONV_CORE, SIZE_CONV_CORE);
        {% else -%}
        LUT lut_eta = LUT(I_CONV_BATT, ETA_CONV_BATT, SIZE_CONV_BATT);
        {% endif -%}
};